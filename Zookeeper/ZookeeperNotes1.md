# Zookeeper

---

## 1.1 概述

分布式系统：分布式系统是指由很多台计算机组成的一个整体，这个整体一致对外，并且处理同一请求。对内透明，对外不透明。内部的每台计算机都可以相互通信。客户端向一个分布式系统发送的一次请求到接收到响应，可能会经历多台计算机。

**Zookeeper**是一个开源的分布式，为分布式应用提供协调服务的Apache项目。多作为为集群提供服务的**中间件**。

* 从设计角度看，Zookeeper是一个基于观察者模式的设计的分布式服务管理框架。负责存储和管理数据，然后接受观察者的注册，一旦这些数据的状态发生变化，Zookeeper就负责通知已经在Zookeeper上注册的观察者做出相应的反应，从而实现集群中类似Master/Slave的管理模式。
* Zookeeper = 文件系统 + 通知机制

## 1.2 特点

* 一致性： zookeeper中的数据按照顺序分批入库，且最终一致。
* 原子性： 一次数据更新，要么成功，要么失败。
* 单一视图： 客户端无论连接到那个Zookeeper节点，数据都是一样的。
* 可靠性： 每次对Zookeeper的操作状态都会保存到服务端，每个Server保存一份相同的数据副本。
* 更新请求顺序进行： 来自同一个客户端的更新请求按其发送顺序依次执行
* 实时性： 在一定时间范围内，客户端能读到最新数据

## 1.3 数据结构

Zookeeper数据模型的结构与Unix文件系统很类似，整体上可以看作是一棵树，每个节点称做一个ZNode。每个ZNode可以类似看作是一个目录，其下可以创建子目录。每一个znode默认能存储1MB的数据，每个ZNode都可以通过其路径唯一标识。

* ZNode存储的是什么数据？
  * Zookeeper存储的是**大家都关心的数据**。比如集群的关键配置信息等

## 1.4 Zookeeper的典型应用场景

* 数据发布与订阅
  * 应用启动时主动到zookeeper上获取配置信息，并注册Watcher（观察者）监听
  * 配置管理员变更Zookeeper配置节点的内容
  * Zookeeper推送变更到应用，触发观察者回调函数
  * 应用根据逻辑，主动获取新的配置信息，更改自身的逻辑
  * 适用于配置信息多设备共享，会发生动态变化

> 注意：数据的订阅与发布是Zookeeper最基础的功能，它的很多功能都是基于此应能实现的。

* 软负载均衡
  * Register负责域名的注册，服务启动后将域名信息通过Register注册到Zookeeper相对应的域名服务下
  * Dispatcher负责域名的解析，可以实现软负载均衡
  * Scanner通过定时检测服务状态，动态更新节点地址信息
  * Monitor负责收集服务信息与状态监控
  * Controller提供后台Console，提供配置管理功能

* 集群管理
  * 有多少及其在工作？
  * 每台机器的运行状态的收集
  * 对集群中的设备进行上下线操作
  * 分布式任务的状态汇报
  * 等等...


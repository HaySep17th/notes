# 一、Hive入门

## 1.1 什么是HIve

Hive是由FaceBook开源用于解决海量结构化日志的数据统计。Hive是基于Hadoop的一个数据仓库工具，可以将*结构化的数据文件映射为一张表*，并提供了类**SQL**查询功能。

* Hive本质上是将**HQL**转化成MapReduce程序。

* Hive与Hadoop的关联：
  * 1）Hive处理的数据存储在HFDFS上；
  * 2）Hive分析数据的底层实现是MapReduce；
  * 3）Hive执行程序是在YARN上；

## 1.2 Hive的优缺点

### 1.2.1 优点

* 操作接口采用类SQL语法，提供快速开发的能力（简单，易上手）。
* 避免了重复写MapReduce，减少开发人员的学习成本。
* Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场景。
* Hive的优势在于处理大数据，对于处理小数据没有优势，因为Hive的延迟比较高。
* Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。

### 1.2.2 缺点

* 1、Hive的HQL表达能力有限
  * 1）无法表达迭代式算法
  * 不擅长数据挖掘

* 2、Hive的效率比较低
  * 1）Hive自动生成的MapReduce作业，通常情况下不够智能化
  * 2）Hive优化比较困难，粒度较粗

## 1.3 Hive架构原理

![DfY4nTWsE2b16eH](https://i.loli.net/2021/05/24/DfY4nTWsE2b16eH.png)

1、用户接口：Client
* CLI：hive shell
* JDBC/ODBC：java访问hive
* WEBUI：浏览器访问hive

2、元数据：MetaStore
元数据包括：表名、表所属的数据库（默认是default）、表的拥有者、列分区字段、表的类型（是否是外部表）、表的数据所在目录等。

* Hive默认存储在自带的debry数据库中，推荐使用MySql存储元数据

3、Hadoop：使用HDFS进行存储，使用MapReduce进行计算

4、驱动器：Driver
* 1）解析器（SQL Parser）：将SQL字符串转换成抽象语法树AST，这一步一般都用第三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL语义是否有误。
* 2）编译器（Physical Plan）：将AST编译生成逻辑执行计划
* 3）优化器（Query Optimizer）：对逻辑执行计划进行优化
* 4）执行器（Execution）： 把逻辑执行计划转换成可以运行的物理计划。
![RV6kgJ3KyCoqPw5](https://i.loli.net/2021/06/06/RV6kgJ3KyCoqPw5.png "Hive运行机制")
* Hive通过给用户提供的一系列交互接口，接受用户的指令，使用自己的Driver结合元数据，将这些指令翻译成MR程序，提交到Hadoop中执行，最后将执行结果输出到用户的交互接口。

## 1.4 Hive和数据库的区别

由于 Hive 采用了类似SQL 的查询语言 HQL(Hive Query Language)，因此很容易将 Hive 理解为数据库。其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。但是，**要知道Hive是为数据仓库而设计的**。

### 1.4.1 查询语言
由于SQL被广泛的应用在数据仓库中，因此，专门针对Hive的特性设计了类SQL的查询语言HQL。

### 1.4.2 数据存储位置
Hive是建立在Hadoop之上的，所有Hive的数据都是存储在HDFS中的。而数据库则可以将数据保存在块设备或者本地文件系统中。

### 1.4.3 数据更新
由于Hive是针对数据仓库应用设计的，而数据仓库的内容是读多写少，所以，Hive中不建议对数据的改写，所有的数据都是在加载的时候确定好的。二数据库中的数据通常需要进行修改，因此可以使用INSERT INTO VALUES添加数据，使用UPDATAE SET修改数据。

### 1.4.4 索引
Hive在加载数据的过程中不会对数据进行任何处理，甚至不会对数据进行扫描，因此，也没有对数据中的某些Key建立索引。Hive要访问数据中满足条件的特定值时，需要暴力扫描整个数据文件，因此访问延迟较高。由于MapReduce的引入，Hive可以进行并行访问数据，因此即使没有索引，对于大数据量的访问，Hive仍然可以体现出优势。
数据库中，通常会针对一个或者多个列建立索引，因此对于少量的特定条件的数据访问，数据库可以有很高的效率以及较低的延迟。
**由于数据的访问有较高的延迟，也决定了Hive不适合在线数据查询。**

### 1.4.5 执行
Hive中大多数查询的执行是通过 Hadoop 提供的 MapReduce 来实现的。而数据库通常有自己的执行引擎。

### 1.4.6 执行延迟
Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导致 Hive 执行延迟高的因素是 MapReduce框架。由于MapReduce 本身具有较高的延迟，因此在利用MapReduce 执行Hive查询时，也会有较高的延迟。
相对的，数据库的执行延迟较低。
当然，这个低是有条件的，即数据规模要小，**当数据规模大到超过数据库的处理能力的时候**，Hive的并行计算显然能体现出优势。

### 1.4.7 可扩展性
由于Hive是建立在Hadoop之上的，因此Hive的可扩展性是和Hadoop的可扩展性是一致的。
> 世界上最大的Hadoop 集群在 Yahoo!，2009年的规模在4000 台节点左右
而数据库由于 ACID 语义的严格限制，扩展行非常有限。
> 目前最先进的并行数据库 Oracle 在理论上的扩展能力也只有100台左右。

### 1.4.8 数据规模
Hive建立在集群上并可以利用MapReduce进行并行计算，因此可以支持很大规模的数据；对应的，数据库可以支持的数据规模较小。
